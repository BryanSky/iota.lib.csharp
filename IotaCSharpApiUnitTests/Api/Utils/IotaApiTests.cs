using System;
using System.Collections.Generic;
using Iota.Lib.CSharp.Api;
using Iota.Lib.CSharp.Api.Core;
using Iota.Lib.CSharp.Api.Model;
using Iota.Lib.CSharp.Api.Utils;
using Microsoft.VisualStudio.TestTools.UnitTesting;
using Newtonsoft.Json;

namespace Iota.Lib.CSharpTests.Api.Utils
{
    [TestClass]
    public class IotaApiTests
    {
        private IotaApi testApi = new IotaApi("node.iotawallet.info", 14265);
        private string seed = "ZEB99QTOMYDSKIFCXTLTVSWQFKO9CRKQKMRDR9HWVOVSGZMWPFQIMSCXXWUULHD9MZKMFJZAYZHZYA9VZ";

        private string firstAddress =
            "LCZXWAQUHBXST9IEPPMJICTWLKJA9HVASXWDIRCVNM9TUAGZY9SRRJLZMZQIZKBAESXXNABFATUAYQYYW";

        [TestMethod]
        public void GetNodeInfoTest()
        {
            GetNodeInfoResponse nodeInfoResponse = testApi.GetNodeInfo();
            Assert.AreEqual("IRI", nodeInfoResponse.AppName);
        }


        [TestMethod]
        public void GetNeighbors()
        {
            GetNeighborsResponse getNeighborsResponse = testApi.GetNeighbors();
            Assert.IsTrue(getNeighborsResponse.Neighbors.Count >= 0);
            Console.WriteLine(JsonConvert.SerializeObject(getNeighborsResponse));
        }


        [TestMethod]
        public void GenerateNewAddress()
        {
            string response = testApi.GetNewAddress(seed, 0, false, 0, true)[0];
            Assert.AreEqual(response, firstAddress);
            Console.WriteLine(response);
        }

        [TestMethod]
        public void GenerateSingleAddress()

        {
            string[] response = testApi.GetNewAddress(seed, 0, false, 1);
            Assert.AreEqual(response[0], firstAddress);
            Console.WriteLine(response[0]);
        }


        [TestMethod]
        public void GetInputs()
        {
            Inputs inputs = testApi.GetInputs(seed, 0, 1, 0);
            Assert.IsTrue(inputs.TotalBalance > 0);
            Console.WriteLine(inputs);
        }

        [TestMethod]
        public void GetBalances()
        {
            GetBalancesResponse response = testApi.GetBalances(
                new List<string>()
                {
                    "RTTBEWDBE9AKPZWUWUGHPOVFJEJBXLAR9WZNERLIIZKAORKZYTTUXHT9YS9UUAIAYAEZAJINAJDWSTEBX9LIIVUPPNEQHSOJVPDTXFBEWTBNYTSUIEWFRMNWPXDD9EKYV9HLOUDRPQAKWWOWLOUFYMRYJMHVWCOGVPJC9ZMXWRYPUILSQEVXEZAJSCUITVQE9AQMLCYCNIHYW9CZRDBINFGIRBRSOZBHBINSAUZTVH9IQPMEKDWFMAIMYYBKHSGXORHUTFNSKRPBFRYRVSRKIIGRSZIHJMTYLLNWRTMQW9PHOQCHPSFTJVGE9T9YHAYTAOTBDDBGOJAQP9ZQQDDEFBMJGGQTPJJYLIANUO9GQEOQTJZAJOLLPELXJYDKVXLRIEKFZVDOWDAZST9YMWCYNOFCIBHXZVKGRHKMERUMWJCIVT9IEQNIXGUUNPQOLIJPZMFTWIKOSWU9UIPVFS9BYNADWCTVPPKKYBWEMOQNQLZKL9DDGUMZMPXRNNVIESQYVRMNVBZSGOOBPZPRDSFTI9S9JAEHWGNYEFLIHFHWJYDZWXSQDIHKWUEZUQFGUTMAUDXJYDPHFK9LUVKHUDNIJYGXHOUFD9WORJQICXTOTRLEAX9TJPJVSQGPEMY9ZNICEOYYYXKUMGFOOJAUWTTEVPJAOHGKLYKFSPQF9HGPENIRJDEXXDAF9ZJYGWJUMM9KVCQAHERSFRXFZZXTPZAMUNTYXSURGFATFFTLTWBAWVNKFCIMRMPTNQB9CBNNNGAFIOUDWXZGGPNAERZSKLMCKDLDLABOX9PMPYDBOFWDRTPAGSFCCYESA9JTEZFOPJMWWQUPLGKHARNLQ9AEOTYHUUIKVMOIAUDFNFWVXHGBEZHXNTTOAADMEMHJSD9VQPCEXEBXARLEGRXBCGWQGCFSGHFCRDTMUUETNVUHWNWQNABKUOFL9LEOVBXSLMVWEYIEJXXKHVBJEPORLIFUXAQTRBUD9KGHGVBOMEMMJZIUFF9NKGMUTVNBNAMEXEVQSGEMFJHJIHWTNTDYEMOCSLFYQYLTKWFPHNHPLCWSOLEHNHFNVY9GCVBQQQUNHSKQQKXMYROHEMKLKJTFWARCRVIG9ZKSFNFZBPM9KWJQRCB9JOYCBLRQCRDPCJLVQ9NMSTHKWTMAPMLTNUQLUPWGIXCHXLAPHIPSSXVEWCEJFVMG9IQWBAENPYTD9FWUDAWVKVBGEBNDALHCRDSEGYNWHXOV9AULXIIEYHXJUJMLHQAVGETV9QQTWRCSA9PYDVERIYOKSWFOAMLBOXROASI9UNCQGJZJUDBGHPEA99ONSYVKVQLUTXXOREKLWEMWQJW9RHQNAJMSOPHCLYPERVBMECLOQXOKNGBKLJM9HSWSFDYXHVQ9JMPQOIYRDNPMUXGFNLKLURKWRDAVUIVZD9TGVX9RWOFKFCQZHIUW9HYWQAVAOGHVYVYJ9KRDZXZXDFBPPYVHKDYCATM9DHLZIE9YUZSRXSAAAIANHFDUT9DMUGVHBUNSDCEDFAEUUKCPJYJBERFRQABECYLBCBRTQEVOSQWXPGHEEDYMSGUWCAATFZRLSYDDNRSY9VOJRREVMORRPURVTBYBK9NAKEAHYAWBTOSD9YYRINXFHIOMBZS9NFYKHDT9ITUPRTMRXJKHTQKIURMWCPSJSPFTSQUKQZHPHSLVJLACEAHTVCJYOFJCLOZMWZLAVHKKLUJG9EVRZAGHKHZVERBPJPDVUNTROZGNJVJJHIQNBZARYYWCPJPGG9LRGZMUKMBSUWHHLHREYWNJDWCXJIUPDIITHPCOAQYSSIWCVYUMQTRIWASCRLWLKHYTZWSEKMANGTVQLONJSOKOK9AMJJCZXJQROJX9SVEAHR9GWGDRVMUCEBENGTMZISZZHXBZHKOEWWCMNHSXLBCU9JDSLCMNKAHPCQRDEJGHQWFIKAJDBAMXZWSUJDGBGWTYWUBCXFF9PLL9NUXWAHNGHDGYRTPWI9AOHCKRYXWBUTYRRZMSQKTGZFBXAHJQWEJJOAMMDCUMCUCYVQLRSDAEBOAQETEJIDHYQLEEQFEZUOJHGAPAQWITCIAUOZQJ9WFLECWDAJVMSJWFTCFITLQOZQDDGWIPGYVFXPJDDPAAUCGWEUGEQSNJL9YDKWEDNAJCNASPCCUFEPZSUHPXOQJXCBJFHDRZYWZMEFRFFVMBCDCNGPJC9PJBMDZKEMGLSFPCVW99JUSBHXTMMEOKYCAXKDWQFJ9OYMYSEBXMI9XDRBIFXNOHTYCWTNZECRKYSSSRLSENYCROEAFILUBNRWWKPCAKUJZPNZBQTPIEFJZJZYBUDCROKFGQEPTETLN9UQJXURADVRAHAHDERQDGTJZNGGLHBHPCIMESOCXCIGTCXGQXQVQSIENVLKJMMEOJXRIHGFVVRTMKKRTXIPACRAL9IIQQUKWWYFFBSBXFUZOSPL9JPH9VLMRJL9VTCEWHRFP9FZRFVNDYGOGRJCROTMJMV9L9LKZFEPKLQEJASAHPKWCJHK9LLUPEVVFEALOXC9IXTIBPQHXSCNG9AEDZBWQZYVJXLZMGFQGDSYOGIHKPO9VEIX9UUKIOATBVQ9QXAHIDIMRBCVTXNZSSVVISOJLSBHBABBCGESFNSMV9MXGPSYCGAXNRKZNJLTHOUZJMIALUXNP9CRVKCAYCXYKHUNXOQGUQJWHRHSWEZFNOELAXCU9NJKIMRHPLGHHUVIWISIXHSDDYCYBB9LLJPCDRSFNNJRSYFADR9QLRHCYQF99NDGPVQQPD9KR9LBFVANSIJSXFTAOTHYTSEQRGROEIV9RIVJZKMPKSJCE9TDKRGCGRWAOTFDSVOW9LR9JVCSAIFVJNPGUBPBCUZZMEIFEDFRKBIRMVVSDBJG9RJWGNFLUJQSCYVJUQLXTBDDW9MYPM9VOEIYXKPQQRYFVO9DIPINPGDPLXQKFGAETFQHXEPYVXRGQDMKPGX9LOPOEWRQKARMXFKPXFKHXNDAVQENPYJOORDPBTKFJT9UGXKCQFHZUQ9VAYASDOSIDEGOOLVNZIWLNZKMOFLAQDNJVUVDN9PMLIJTQGAIMTZYZBHMXGPFOQR9KAREYSJQARJGQY9VMPJXZOKSXQXTR9KXYEVTSKRGZVBWSRTRMC9GAKOIYWWVMT9YANUKWIIXUPCLODQLDYUYWPNRPXIY9Q9SJF9EEIBSACOJFMIZMOGIGQISIHPTKXULJSAFFZVJYPGILRTJHBLBKHIFMYRZJRUODJFOEBKAKTOSJWERQEAUAYRPYBJLUOVKCTKHHATKLRLNBAHKSUQBNXSOQZDOBZKJNHWSVDIJBSKIPLTEDRHCNTMDINESRUZLUSEOFBVBFLURCQHSENUDLWDNTBYU9MIUUWDDIWQRGKBPRSLWVSJZXVAEGSRKVRLGTVMEUIEVNMZCTNZEJLGCNWWRGDOPDZQQKVMWUSTTOUWGQYIOUMTNZYYURCINXSFWWJVWZXFOEDFOUZ9DEJLFPDTYDNNU9CDZCJKLINCWRMO9NZNKWBTXVVIHRTPPTZCINBMNAM9IYDHLFPDLYISXNPSTO9ZNYSCEMYJSHWCMJNETGIKT9RJOWSPXWQLD9MTYPSFXRWIDXUDFXWTUAWPBRLEKMIZXQGHNL9XGRZBZS9LLTNZLPSXVOSRWEFAYX9CIPTLPCUZN9JQKM99FVPOBGSWDFWBASKANSHHUJIFGUBLUYSRIP9GKGXODHQTRRIKMUJ9QNISCNDJUKRJJORGZCRPQAWUHJQBXRYJEQQURVWRYWJSVBCTTKNCDHVGBPGHFZULCZOLGSCHD9SWFBWZRBCAQALEFNRHILOHWOCANKSU9UWRNPGONIMDT9IWSGLYEMQXXGRJOZJOGOZJAHKUID9B9YFDBWVQLLCCBVFCRTSNLHBFJLOQTNMWYUSFVFJIBMZG9HIZCPDPGMGHXYYGXXOLUMQXRPDLQAUSDRBHPNQXPDTPNWVQOKFISMKGOUWJLBJMYXYNKCCLOMFAUSGNKOHR9TTNBUMCSWWLUZWZTNR9HSZGAKZAFGEOATHZNKTZH9VYCDFGDTTOKLRVJDMFOXIUMROYPD9EMIZACK9MZEKDUASCNEJYCMKBSX9XQNQQYAPJAHQYBKJRBNSQANNCHWBRJFCUWLUISXFNXLSCZPEXFX9HRMNCOTT9PGSAYAEPPGDXRICOLYFFVDEAAXHDR9UTTJP9ZRXGASZIKEZJ9WF9TJWNONNJHXQERIAZDOFT9ZIWUADPTVJUVUNYGX9AHJOM9LUDUMAUUCVITMMVSMYLSYTGNMK9JKRE9MUPLDDNDMQFMVDMGGJTSPJZPARCWCFUGVWZYF99ERISRJFHRJUCIWTSOTNZUZSRGLLZEKHPVUNAB"
                }, 1);

            Assert.IsTrue(response.Balances != null);
            Assert.IsFalse(string.IsNullOrEmpty(response.Milestone));
        }

        [TestMethod]
        [ExpectedException(typeof(IotaApiException))]
        public void ApiErrorException()
        {
            GetBalancesResponse response = testApi.GetBalances(
                new List<string>()
                {
                    "RTTBEWDBE9AKPZWUWUGHPOVFJEJBXLAR9WZNERLIIZKAORKZYTTUXHT9YS9UUAIAYAEZAJINAJDWSTEBX9LIIVUPPNEQHSOJVPDTXFBEWTBNYTSUIEWFRMNWPXDD9EKYV9HLOUDRPQAKWWOWLOUFYMRYJMHVWCOGVPJC9ZMXWRYPUILSQEVXEZAJSCUITVQE9AQMLCYCNIHYW9CZRDBINFGIRBRSOZBHBINSAUZTVH9IQPMEKDWFMAIMYYBKHSGXORHUTFNSKRPBFRYRVSRKIIGRSZIHJMTYLLNWRTMQW9PHOQCHPSFTJVGE9T9YHAYTAOTBDDBGOJAQP9ZQQDDEFBMJGGQTPJJYLIANUO9GQEOQTJZAJOLLPELXJYDKVXLRIEKFZVDOWDAZST9YMWCYNOFCIBHXZVKGRHKMERUMWJCIVT9IEQNIXGUUNPQOLIJPZMFTWIKOSWU9UIPVFS9BYNADWCTVPPKKYBWEMOQNQLZKL9DDGUMZMPXRNNVIESQYVRMNVBZSGOOBPZPRDSFTI9S9JAEHWGNYEFLIHFHWJYDZWXSQDIHKWUEZUQFGUTMAUDXJYDPHFK9LUVKHUDNIJYGXHOUFD9WORJQICXTOTRLEAX9TJPJVSQGPEMY9ZNICEOYYYXKUMGFOOJAUWTTEVPJAOHGKLYKFSPQF9HGPENIRJDEXXDAF9ZJYGWJUMM9KVCQAHERSFRXFZZXTPZAMUNTYXSURGFATFFTLTWBAWVNKFCIMRMPTNQB9CBNNNGAFIOUDWXZGGPNAERZSKLMCKDLDLABOX9PMPYDBOFWDRTPAGSFCCYESA9JTEZFOPJMWWQUPLGKHARNLQ9AEOTYHUUIKVMOIAUDFNFWVXHGBEZHXNTTOAADMEMHJSD9VQPCEXEBXARLEGRXBCGWQGCFSGHFCRDTMUUETNVUHWNWQNABKUOFL9LEOVBXSLMVWEYIEJXXKHVBJEPORLIFUXAQTRBUD9KGHGVBOMEMMJZIUFF9NKGMUTVNBNAMEXEVQSGEMFJHJIHWTNTDYEMOCSLFYQYLTKWFPHNHPLCWSOLEHNHFNVY9GCVBQQQUNHSKQQKXMYROHEMKLKJTFWARCRVIG9ZKSFNFZBPM9KWJQRCB9JOYCBLRQCRDPCJLVQ9NMSTHKWTMAPMLTNUQLUPWGIXCHXLAPHIPSSXVEWCEJFVMG9IQWBAENPYTD9FWUDAWVKVBGEBNDALHCRDSEGYNWHXOV9AULXIIEYHXJUJMLHQAVGETV9QQTWRCSA9PYDVERIYOKSWFOAMLBOXROASI9UNCQGJZJUDBGHPEA99ONSYVKVQLUTXXOREKLWEMWQJW9RHQNAJMSOPHCLYPERVBMECLOQXOKNGBKLJM9HSWSFDYXHVQ9JMPQOIYRDNPMUXGFNLKLURKWRDAVUIVZD9TGVX9RWOFKFCQZHIUW9HYWQAVAOGHVYVYJ9KRDZXZXDFBPPYVHKDYCATM9DHLZIE9YUZSRXSAAAIANHFDUT9DMUGVHBUNSDCEDFAEUUKCPJYJBERFRQABECYLBCBRTQEVOSQWXPGHEEDYMSGUWCAATFZRLSYDDNRSY9VOJRREVMORRPURVTBYBK9NAKEAHYAWBTOSD9YYRINXFHIOMBZS9NFYKHDT9ITUPRTMRXJKHTQKIURMWCPSJSPFTSQUKQZHPHSLVJLACEAHTVCJYOFJCLOZMWZLAVHKKLUJG9EVRZAGHKHZVERBPJPDVUNTROZGNJVJJHIQNBZARYYWCPJPGG9LRGZMUKMBSUWHHLHREYWNJDWCXJIUPDIITHPCOAQYSSIWCVYUMQTRIWASCRLWLKHYTZWSEKMANGTVQLONJSOKOK9AMJJCZXJQROJX9SVEAHR9GWGDRVMUCEBENGTMZISZZHXBZHKOEWWCMNHSXLBCU9JDSLCMNKAHPCQRDEJGHQWFIKAJDBAMXZWSUJDGBGWTYWUBCXFF9PLL9NUXWAHNGHDGYRTPWI9AOHCKRYXWBUTYRRZMSQKTGZFBXAHJQWEJJOAMMDCUMCUCYVQLRSDAEBOAQETEJIDHYQLEEQFEZUOJHGAPAQWITCIAUOZQJ9WFLECWDAJVMSJWFTCFITLQOZQDDGWIPGYVFXPJDDPAAUCGWEUGEQSNJL9YDKWEDNAJCNASPCCUFEPZSUHPXOQJXCBJFHDRZYWZMEFRFFVMBCDCNGPJC9PJBMDZKEMGLSFPCVW99JUSBHXTMMEOKYCAXKDWQFJ9OYMYSEBXMI9XDRBIFXNOHTYCWTNZECRKYSSSRLSENYCROEAFILUBNRWWKPCAKUJZPNZBQTPIEFJZJZYBUDCROKFGQEPTETLN9UQJXURADVRAHAHDERQDGTJZNGGLHBHPCIMESOCXCIGTCXGQXQVQSIENVLKJMMEOJXRIHGFVVRTMKKRTXIPACRAL9IIQQUKWWYFFBSBXFUZOSPL9JPH9VLMRJL9VTCEWHRFP9FZRFVNDYGOGRJCROTMJMV9L9LKZFEPKLQEJASAHPKWCJHK9LLUPEVVFEALOXC9IXTIBPQHXSCNG9AEDZBWQZYVJXLZMGFQGDSYOGIHKPO9VEIX9UUKIOATBVQ9QXAHIDIMRBCVTXNZSSVVISOJLSBHBABBCGESFNSMV9MXGPSYCGAXNRKZNJLTHOUZJMIALUXNP9CRVKCAYCXYKHUNXOQGUQJWHRHSWEZFNOELAXCU9NJKIMRHPLGHHUVIWISIXHSDDYCYBB9LLJPCDRSFNNJRSYFADR9QLRHCYQF99NDGPVQQPD9KR9LBFVANSIJSXFTAOTHYTSEQRGROEIV9RIVJZKMPKSJCE9TDKRGCGRWAOTFDSVOW9LR9JVCSAIFVJNPGUBPBCUZZMEIFEDFRKBIRMVVSDBJG9RJWGNFLUJQSCYVJUQLXTBDDW9MYPM9VOEIYXKPQQRYFVO9DIPINPGDPLXQKFGAETFQHXEPYVXRGQDMKPGX9LOPOEWRQKARMXFKPXFKHXNDAVQENPYJOORDPBTKFJT9UGXKCQFHZUQ9VAYASDOSIDEGOOLVNZIWLNZKMOFLAQDNJVUVDN9PMLIJTQGAIMTZYZBHMXGPFOQR9KAREYSJQARJGQY9VMPJXZOKSXQXTR9KXYEVTSKRGZVBWSRTRMC9GAKOIYWWVMT9YANUKWIIXUPCLODQLDYUYWPNRPXIY9Q9SJF9EEIBSACOJFMIZMOGIGQISIHPTKXULJSAFFZVJYPGILRTJHBLBKHIFMYRZJRUODJFOEBKAKTOSJWERQEAUAYRPYBJLUOVKCTKHHATKLRLNBAHKSUQBNXSOQZDOBZKJNHWSVDIJBSKIPLTEDRHCNTMDINESRUZLUSEOFBVBFLURCQHSENUDLWDNTBYU9MIUUWDDIWQRGKBPRSLWVSJZXVAEGSRKVRLGTVMEUIEVNMZCTNZEJLGCNWWRGDOPDZQQKVMWUSTTOUWGQYIOUMTNZYYURCINXSFWWJVWZXFOEDFOUZ9DEJLFPDTYDNNU9CDZCJKLINCWRMO9NZNKWBTXVVIHRTPPTZCINBMNAM9IYDHLFPDLYISXNPSTO9ZNYSCEMYJSHWCMJNETGIKT9RJOWSPXWQLD9MTYPSFXRWIDXUDFXWTUAWPBRLEKMIZXQGHNL9XGRZBZS9LLTNZLPSXVOSRWEFAYX9CIPTLPCUZN9JQKM99FVPOBGSWDFWBASKANSHHUJIFGUBLUYSRIP9GKGXODHQTRRIKMUJ9QNISCNDJUKRJJORGZCRPQAWUHJQBXRYJEQQURVWRYWJSVBCTTKNCDHVGBPGHFZULCZOLGSCHD9SWFBWZRBCAQALEFNRHILOHWOCANKSU9UWRNPGONIMDT9IWSGLYEMQXXGRJOZJOGOZJAHKUID9B9YFDBWVQLLCCBVFCRTSNLHBFJLOQTNMWYUSFVFJIBMZG9HIZCPDPGMGHXYYGXXOLUMQXRPDLQAUSDRBHPNQXPDTPNWVQOKFISMKGOUWJLBJMYXYNKCCLOMFAUSGNKOHR9TTNBUMCSWWLUZWZTNR9HSZGAKZAFGEOATHZNKTZH9VYCDFGDTTOKLRVJDMFOXIUMROYPD9EMIZACK9MZEKDUASCNEJYCMKBSX9XQNQQYAPJAHQYBKJRBNSQANNCHWBRJFCUWLUISXFNXLSCZPEXFX9HRMNCOTT9PGSAYAEPPGDXRICOLYFFVDEAAXHDR9UTTJP9ZRXGASZIKEZJ9WF9TJWNONNJHXQERIAZDOFT9ZIWUADPTVJUVUNYGX9AHJOM9LUDUMAUUCVITMMVSMYLSYTGNMK9JKRE9MUPLDDNDMQFMVDMGGJTSPJZPARCWCFUGVWZYF99ERISRJFHRJUCIWTSOTNZUZSRGLLZEKHPVUNAB"
                }, 0);
        }
    }
}